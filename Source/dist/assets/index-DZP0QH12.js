!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e{constructor(e){this.id=e.id||Date.now(),this.title=e.title||"",this.author=e.author||"",this.category=e.category||"",this.cover=e.cover||"",this.description=e.description||"",this.createdAt=e.createdAt||Date.now(),this.validate()}validate(){if(!this.title.trim())throw new Error("Tiêu đề sách không được để trống");if(!this.author.trim())throw new Error("Tác giả không được để trống");if(!this.category.trim())throw new Error("Thể loại không được để trống")}update(e){Object.assign(this,e),this.validate()}toJSON(){return{id:this.id,title:this.title,author:this.author,category:this.category,cover:this.cover,description:this.description,createdAt:this.createdAt}}static fromJSON(t){return new e(t)}}class t{static create(t,o){const n={id:o.id||Date.now(),title:o.title||"",author:o.author||"",category:o.category||"",cover:o.cover||"",description:o.description||"",createdAt:o.createdAt||Date.now()};switch(t.toLowerCase()){case"comic":n.category=n.category||"Truyện tranh",n.description=n.description||"Truyện tranh với hình ảnh minh họa sinh động";break;case"novel":n.category=n.category||"Tiểu thuyết",n.description=n.description||"Tiểu thuyết văn học với cốt truyện hấp dẫn";break;case"textbook":n.category=n.category||"Sách giáo khoa",n.description=n.description||"Sách giáo khoa chuyên môn"}return new e(n)}static createMultiple(t){return t.map(t=>new e(t))}static getTypes(){return["comic","novel","textbook","general"]}static createComic(e){return this.create("comic",e)}static createNovel(e){return this.create("novel",e)}static createTextbook(e){return this.create("textbook",e)}static createGeneral(e){return this.create("general",e)}}const o=new class{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t)}off(e,t){this.events.has(e)&&this.events.get(e).delete(t)}emit(e,t){this.events.has(e)&&this.events.get(e).forEach(o=>{try{o(t)}catch(n){console.error(`Error in event callback for "${e}":`,n)}})}once(e,t){const o=n=>{t(n),this.off(e,o)};this.on(e,o)}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}getEventNames(){return Array.from(this.events.keys())}getListenerCount(e){return this.events.has(e)?this.events.get(e).size:0}},n="books:changed",i="book:added",s="book:updated",r="book:deleted",a="book:selected",l="modal:open",c="search:changed",h="filter:changed",d="error:occurred",m="success:message";class g{constructor(){if(g.instance)return g.instance;this.STORAGE_KEY="bookverse_books",this.books=[],this.loadFromStorage(),g.instance=this}static getInstance(){return g.instance||(g.instance=new g),g.instance}loadFromStorage(){try{console.log("BookManager: Loading from storage...");const e=localStorage.getItem(this.STORAGE_KEY);if(console.log("BookManager: Stored data:",e),e){const o=JSON.parse(e);console.log("BookManager: Parsed books data:",o),this.books=t.createMultiple(o),console.log("BookManager: Created books:",this.books)}else console.log("BookManager: No stored data found"),this.books=[]}catch(e){console.error("Error loading books from storage:",e),this.books=[],o.emit(d,{message:"Không thể tải dữ liệu từ bộ nhớ",error:e})}}saveToStorage(){try{const e=this.books.map(e=>e.toJSON());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Error saving books to storage:",e),o.emit(d,{message:"Không thể lưu dữ liệu vào bộ nhớ",error:e})}}getAll(){return[...this.books]}getById(e){return this.books.find(t=>t.id===e)||null}add(t){try{const s=new e(t);return this.books.push(s),this.saveToStorage(),o.emit(i,s),o.emit(n,this.getAll()),s}catch(s){throw o.emit(d,{message:"Không thể thêm sách mới",error:s}),s}}update(e,t){try{const i=this.getById(e);if(!i)throw new Error("Không tìm thấy sách cần cập nhật");return i.update(t),this.saveToStorage(),o.emit(s,i),o.emit(n,this.getAll()),i}catch(i){throw o.emit(d,{message:"Không thể cập nhật sách",error:i}),i}}remove(e){try{const t=this.books.findIndex(t=>t.id===e);if(-1===t)return!1;const i=this.books[t];return this.books.splice(t,1),this.saveToStorage(),o.emit(r,i),o.emit(n,this.getAll()),!0}catch(t){throw o.emit(d,{message:"Không thể xóa sách",error:t}),t}}search(e){if(!e.trim())return this.getAll();const t=e.toLowerCase();return this.books.filter(e=>e.title.toLowerCase().includes(t)||e.author.toLowerCase().includes(t)||e.category.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}filterByCategory(e){return e?this.books.filter(t=>t.category===e):this.getAll()}getCategories(){const e=this.books.map(e=>e.category);return[...new Set(e)].sort()}getStats(){const e=this.books.length,t=this.getCategories().length,o={};this.books.forEach(e=>{o[e.category]=(o[e.category]||0)+1});return{totalBooks:e,totalCategories:t,popularCategory:Object.keys(o).reduce((e,t)=>o[e]>o[t]?e:t,"-"),categoryCount:o}}clear(){this.books=[],this.saveToStorage(),o.emit(n,this.getAll())}importBooks(e){try{const i=t.createMultiple(e);this.books.push(...i),this.saveToStorage(),o.emit(n,this.getAll()),o.emit(m,{message:`Đã import ${i.length} sách thành công`})}catch(i){throw o.emit(d,{message:"Không thể import sách",error:i}),i}}}const u=g.getInstance(),p={},y=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),s=(null==i?void 0:i.nonce)||(null==i?void 0:i.getAttribute("nonce"));n=Promise.allSettled(t.map(t=>{if(t=function(e,t){return new URL(e,t).href}(t,o),t in p)return;p[t]=!0;const n=t.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(!!o)for(let o=e.length-1;o>=0;o--){const i=e[o];if(i.href===t&&(!n||"stylesheet"===i.rel))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;const r=document.createElement("link");return r.rel=n?"stylesheet":"modulepreload",n||(r.as="script"),r.crossOrigin="",r.href=t,s&&r.setAttribute("nonce",s),document.head.appendChild(r),n?new Promise((e,o)=>{r.addEventListener("load",e),r.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})};class v{static create(e){const t=e.cover||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDIwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgMTAwSDgwVjEyMEgxMDBWMTAwWiIgZmlsbD0iI0QxRDVEQyIvPgo8cGF0aCBkPSJNMTIwIDEyMEg4MFYxNDBIMTIwVjEyMFoiIGZpbGw9IiNEQzEzNDEiLz4KPHA+dGggZD0iTTEwMCAxNDBIODBWMTYwSDEwMFYxNDBaIiBmaWxsPSIjRENEM0M0Ii8+CjxwYXRoIGQ9Ik0xMjAgMTYwSDgwVjE4MEgxMjBWMTYwWiIgZmlsbD0iI0U1RjdFQiIvPgo8dGV4dCB4PSIxMDAiIHk9IjIwMCIgZm9udC1mYW1pbHk9IkludGVyIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjY3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5KaIFNhw6NjaDwvdGV4dD4KPC9zdmc+";return`\n            <div class="book-card glass-card" data-id="${e.id}" role="gridcell" tabindex="0" aria-label="Sách: ${this.escapeHtml(e.title)} - Tác giả: ${this.escapeHtml(e.author)}">\n\t\t\t\t<div class="book-cover">\n\t\t\t\t\t<img src="${t}" \n\t\t\t\t\t\t alt="Ảnh bìa sách ${this.escapeHtml(e.title)}" \n\t\t\t\t\t\t loading="lazy"\n\t\t\t\t\t\t onload="this.style.opacity='1'"\n\t\t\t\t\t\t onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDIwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgMTAwSDgwVjEyMEgxMDBWMTAwWiIgZmlsbD0iI0QxRDVEQyIvPgo8cGF0aCBkPSJNMTIwIDEyMEg4MFYxNDBIMTIwVjEyMFoiIGZpbGw9IiNEQzEzNDEiLz4KPHA+dGggZD0iTTEwMCAxNDBIODBWMTYwSDEwMFYxNDBaIiBmaWxsPSIjRENEM0M0Ii8+CjxwYXRoIGQ9Ik0xMjAgMTYwSDgwVjE4MEgxMjBWMTYwWiIgZmlsbD0iI0U1RjdFQiIvPgo8dGV4dCB4PSIxMDAiIHk9IjIwMCIgZm9udC1mYW1pbHk9IkludGVyIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjY3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5KaIFNhw6NjaDwvdGV4dD4KPC9zdmc+'; this.style.opacity='1'"\n\t\t\t\t\t\t style="opacity:0; transition: opacity 0.3s ease;">\n                </div>\n                <div class="book-info">\n                    <h3 class="book-title">${this.escapeHtml(e.title)}</h3>\n                    <p class="book-author">${this.escapeHtml(e.author)}</p>\n                    <span class="book-category" aria-label="Thể loại: ${this.escapeHtml(e.category)}">${this.escapeHtml(e.category)}</span>\n                    ${e.description?`<p class="book-description">${this.escapeHtml(e.description)}</p>`:""}\n                </div>\n                <div class="book-actions" role="group" aria-label="Hành động với sách">\n                    <button class="btn btn-sm btn-edit edit-btn" data-id="${e.id}" aria-label="Chỉnh sửa sách ${this.escapeHtml(e.title)}">\n                        <span aria-hidden="true">✏️</span>\n                    </button>\n                    <button class="btn btn-sm btn-delete delete-btn" data-id="${e.id}" aria-label="Xóa sách ${this.escapeHtml(e.title)}">\n                        <span aria-hidden="true">🗑️</span>\n                    </button>\n                </div>\n            </div>\n        `}static escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}static createEmptyState(){return'\n            <div class="empty-state glass">\n                <div class="empty-icon">📚</div>\n                <h3>Chưa có sách nào</h3>\n                <p>Hãy thêm sách đầu tiên để bắt đầu quản lý thư viện của bạn!</p>\n                <button class="btn btn-primary" id="addFirstBookBtn">\n                    <span>+</span> Thêm Sách Đầu Tiên\n                </button>\n            </div>\n        '}static createLoadingState(){return'\n            <div class="loading-state glass">\n                <div class="loading-spinner"></div>\n                <p>Đang tải dữ liệu...</p>\n            </div>\n        '}static addHoverEffects(e){e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-8px) scale(1.02)"}),e.addEventListener("mouseleave",()=>{e.style.transform="translateY(0) scale(1)"})}static removeHoverEffects(e){e.removeEventListener("mouseenter",()=>{}),e.removeEventListener("mouseleave",()=>{})}}class b{constructor(){this.elements={},this.chart=null,this.searchTimeout=null,this.init()}init(){console.log("View: Initializing..."),console.log("View: Caching elements..."),this.cacheElements(),console.log("View: Elements cached:",this.elements),console.log("View: Setting up event listeners..."),this.setupEventListeners(),console.log("View: Event listeners setup complete"),console.log("View: Initializing chart..."),setTimeout(async()=>{await this.initializeChart(),console.log("View: Chart initialization complete")},200),console.log("View: Initialization complete")}cacheElements(){this.elements={booksContainer:document.getElementById("booksContainer"),emptyState:document.getElementById("emptyState"),searchInput:document.getElementById("searchInput"),categoryFilter:document.getElementById("categoryFilter"),totalBooks:document.getElementById("totalBooks"),totalCategories:document.getElementById("totalCategories"),popularCategory:document.getElementById("popularCategory"),categoryChart:document.getElementById("categoryChart"),addBookBtn:document.getElementById("addBookBtn"),exportBtn:document.getElementById("exportBtn"),importInput:document.getElementById("importInput"),addFirstBookBtn:null}}setupEventListeners(){this.elements.searchInput&&this.elements.searchInput.addEventListener("input",e=>{clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{o.emit(c,e.target.value)},300)}),this.elements.categoryFilter&&this.elements.categoryFilter.addEventListener("change",e=>{o.emit(h,e.target.value)}),this.elements.addBookBtn&&this.elements.addBookBtn.addEventListener("click",()=>{o.emit(l,{mode:"add"})}),this.elements.exportBtn&&this.elements.exportBtn.addEventListener("click",()=>{o.emit("books:export")}),this.elements.importInput&&this.elements.importInput.addEventListener("change",async e=>{const t=e.target.files&&e.target.files[0];if(t)try{const n=await t.text();o.emit("books:import",n),e.target.value=""}catch(n){this.showError("Không thể đọc file JSON")}}),this.elements.booksContainer&&this.elements.booksContainer.addEventListener("click",e=>{this.handleBookAction(e)})}handleBookAction(e){const t=e.target.closest(".edit-btn, .delete-btn");if(!t)return;const n=parseInt(t.dataset.id),i=t.classList.contains("edit-btn")?"edit":"delete";"edit"===i?o.emit(a,{id:n,action:"edit"}):"delete"===i&&confirm("Bạn có chắc chắn muốn xóa sách này?")&&o.emit(a,{id:n,action:"delete"})}renderBooks(e){this.elements.booksContainer&&(e&&0!==e.length?(this.elements.booksContainer.style.opacity="0",this.elements.booksContainer.style.transform="translateY(20px)",this.elements.booksContainer.innerHTML=e.map(e=>v.create(e)).join(""),this.elements.emptyState&&(this.elements.emptyState.style.display="none"),this.elements.booksContainer.style.display="grid",this.addHoverEffects(),requestAnimationFrame(()=>{this.elements.booksContainer.style.transition="all 0.3s ease",this.elements.booksContainer.style.opacity="1",this.elements.booksContainer.style.transform="translateY(0)"})):this.renderEmptyState())}renderEmptyState(){this.elements.booksContainer&&(this.elements.booksContainer.innerHTML=v.createEmptyState(),this.elements.booksContainer.style.display="flex",this.elements.emptyState&&(this.elements.emptyState.style.display="none"),this.elements.addFirstBookBtn=document.getElementById("addFirstBookBtn"),this.elements.addFirstBookBtn&&this.elements.addFirstBookBtn.addEventListener("click",()=>{o.emit(l,{mode:"add"})}))}addHoverEffects(){this.elements.booksContainer.querySelectorAll(".book-card").forEach(e=>{v.addHoverEffects(e)})}renderStats(e){console.log("View: Rendering stats:",e),this.elements.totalBooks&&this.animateNumber(this.elements.totalBooks,e.totalBooks),this.elements.totalCategories&&this.animateNumber(this.elements.totalCategories,e.totalCategories),this.elements.popularCategory&&(this.elements.popularCategory.textContent=e.popularCategory),console.log("View: Force updating chart with stats:",e.categoryCount),this.forceUpdateChart(e.categoryCount)}animateNumber(e,t){const o=t-(parseInt(e.textContent)||0);0!==o&&(e.style.transform="scale(1.1)",e.style.color=o>0?"#10B981":"#EF4444",e.textContent=t,setTimeout(()=>{e.style.transform="scale(1)",e.style.color="#0f172a"},300))}updateCategoryFilter(e){if(!this.elements.categoryFilter)return;const t=this.elements.categoryFilter,o=t.value;t.innerHTML='<option value="">Tất cả thể loại</option>',e.forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)}),e.includes(o)&&(t.value=o),e.length>0&&(t.style.borderColor="#7DD3FC",t.style.boxShadow="0 0 0 3px rgba(125, 211, 252, 0.2)")}async initializeChart(){try{if(!this.elements.categoryChart)return void console.log("Chart element not found, skipping chart initialization");let t,o;console.log("Loading Chart.js...");try{const e=await y(()=>import("./chart-Csos_q3R.js"),[],import.meta.url);t=e.Chart,o=e.registerables}catch(e){return console.warn("Chart.js import failed, using fallback:",e),void this.createFallbackChart()}t.register(...o),console.log("Chart.js loaded successfully"),this.chart=new t(this.elements.categoryChart,{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"],borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,font:{family:"Inter",size:12,weight:"500"},color:"#2D3748"}}}}}),console.log("Chart initialized successfully")}catch(t){console.error("Error initializing chart:",t),this.createFallbackChart()}}createFallbackChart(){this.elements.categoryChart&&(this.elements.categoryChart.innerHTML='\n                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px; color: #64748b;">\n                    <div style="font-size: 2rem; margin-bottom: 1rem;">📊</div>\n                    <div style="text-align: center;">\n                        <p style="margin: 0; font-weight: 500;">Biểu đồ thống kê</p>\n                        <p style="margin: 0; font-size: 0.875rem;">Sẽ hiển thị khi có dữ liệu</p>\n                    </div>\n                </div>\n            ')}updateChart(e){if(console.log("View: Updating chart with data:",e),!this.chart)return console.log("View: Chart not initialized, using fallback display"),void this.updateFallbackChart(e);const t=Object.keys(e),o=Object.values(e);console.log("View: Chart categories:",t),console.log("View: Chart counts:",o),this.chart.data.labels=t,this.chart.data.datasets[0].data=o,this.chart.update(),console.log("View: Chart updated successfully")}updateFallbackChart(e){if(!this.elements.categoryChart)return;const t=Object.keys(e),o=Object.values(e);if(console.log("View: Updating fallback chart with:",{categories:t,counts:o}),0===t.length)return void this.createFallbackChart();const n=t.map((e,t)=>{const n=o[t],i=o.reduce((e,t)=>e+t,0),s=i>0?(n/i*100).toFixed(1):0,r=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"],a=r[t%r.length];return`\n                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">\n                    <div style="display: flex; align-items: center; gap: 12px;">\n                        <div style="width: 12px; height: 12px; background: ${a}; border-radius: 50%; border: 2px solid #ffffff;"></div>\n                        <span style="color: #0f172a; font-weight: 500; font-size: 14px;">${e}</span>\n                    </div>\n                    <div style="display: flex; align-items: center; gap: 12px;">\n                        <div style="width: 80px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">\n                            <div style="width: ${s}%; height: 100%; background: ${a}; transition: width 0.3s ease;"></div>\n                        </div>\n                        <span style="color: #64748b; font-size: 12px; min-width: 40px; text-align: right; font-weight: 600;">${n}</span>\n                        <span style="color: #94a3b8; font-size: 11px; min-width: 35px; text-align: right;">${s}%</span>\n                    </div>\n                </div>\n            `}).join("");this.elements.categoryChart.innerHTML=`\n            <div style="padding: 20px;">\n                <div style="display: flex; flex-direction: column; gap: 4px;">\n                    ${n}\n                </div>\n            </div>\n        `,console.log("View: Fallback chart updated successfully")}forceUpdateChart(e){console.log("View: Force updating chart..."),this.chart?this.updateChart(e):this.elements.categoryChart&&this.initializeChart().then(()=>{setTimeout(()=>{this.updateChart(e)},100)}).catch(()=>{this.updateFallbackChart(e)})}showLoading(){this.elements.booksContainer.innerHTML=v.createLoadingState(),this.elements.booksContainer.style.display="flex"}showError(e){this.showToast(e,"error")}showSuccess(e){this.showToast(e,"success")}showToast(e,t="info"){const o=document.getElementById("toast");o.textContent=e,o.className=`toast glass toast-${t}`,o.style.display="block",requestAnimationFrame(()=>{o.classList.add("show")}),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.style.display="none"},300)},3e3)}clearSearch(){this.elements.searchInput&&(this.elements.searchInput.value="")}clearFilter(){this.elements.categoryFilter&&(this.elements.categoryFilter.value="")}focusSearch(){this.elements.searchInput&&this.elements.searchInput.focus()}getSearchQuery(){return this.elements.searchInput?this.elements.searchInput.value:""}getFilterValue(){return this.elements.categoryFilter?this.elements.categoryFilter.value:""}}class k{constructor(){this.modal=null,this.overlay=null,this.form=null,this.currentBookId=null,this.isOpen=!1}init(){this.modal=document.getElementById("bookModal"),this.modal?(this.overlay=this.modal.querySelector(".modal-overlay")||this.modal,this.form=document.getElementById("bookForm"),this.setupEventListeners()):console.error("Modal element not found")}setupEventListeners(){const e=document.getElementById("modalClose"),t=document.getElementById("modalCancel");e&&e.addEventListener("click",()=>this.close()),t&&t.addEventListener("click",()=>this.close()),this.overlay&&this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen&&this.close()}),this.form&&this.form.addEventListener("submit",e=>{e.preventDefault(),this.handleSubmit()}),this.setupFormValidation()}setupFormValidation(){["bookTitle","bookAuthor","bookCategory"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("input",()=>this.validateField(t)),t.addEventListener("blur",()=>this.validateField(t)))});const e=document.getElementById("bookCover");e&&(e.addEventListener("input",()=>this.updateCoverPreview()),e.addEventListener("blur",()=>this.updateCoverPreview()))}validateField(e){const t=""!==e.value.trim(),o=document.getElementById(e.id+"-error");t?(e.classList.remove("error"),e.classList.add("valid"),e.setAttribute("aria-invalid","false"),o&&(o.textContent="")):(e.classList.remove("valid"),e.classList.add("error"),e.setAttribute("aria-invalid","true"),o&&(o.textContent="Trường này không được để trống")),this.updateSubmitButton()}updateSubmitButton(){const e=["bookTitle","bookAuthor","bookCategory"].every(e=>{const t=document.getElementById(e);return t&&""!==t.value.trim()}),t=document.getElementById("modalSave");t&&(t.disabled=!e,t.textContent=this.currentBookId?"Cập nhật":"Thêm sách")}openForAdd(){this.currentBookId=null,this.resetForm(),this.setTitle("Thêm Sách Mới"),this.open()}openForEdit(e){this.currentBookId=e.id,this.fillForm(e),this.setTitle("Chỉnh Sửa Sách"),this.open()}open(){this.isOpen=!0,this.modal.style.display="flex",this.modal.setAttribute("aria-hidden","false"),this.trapFocus(),requestAnimationFrame(()=>{this.modal.classList.add("show")});const e=document.getElementById("bookTitle");e&&e.focus(),this.announceModalOpen()}close(){this.isOpen=!1,this.modal.classList.remove("show"),this.modal.setAttribute("aria-hidden","true"),setTimeout(()=>{this.modal.style.display="none",this.resetForm(),this.cleanup()},300),this.returnFocus()}setTitle(e){const t=document.getElementById("modalTitle");t&&(t.textContent=e)}resetForm(){if(this.form){this.form.reset();this.form.querySelectorAll("input, textarea").forEach(e=>{e.classList.remove("error","valid")})}this.currentBookId=null,this.updateSubmitButton();const e=document.getElementById("coverPreview");e&&e.parentElement&&e.parentElement.remove()}fillForm(e){const t={bookTitle:document.getElementById("bookTitle"),bookAuthor:document.getElementById("bookAuthor"),bookCategory:document.getElementById("bookCategory"),bookCover:document.getElementById("bookCover"),bookDescription:document.getElementById("bookDescription")};t.bookTitle&&(t.bookTitle.value=e.title||""),t.bookAuthor&&(t.bookAuthor.value=e.author||""),t.bookCategory&&(t.bookCategory.value=e.category||""),t.bookCover&&(t.bookCover.value=e.cover||""),t.bookDescription&&(t.bookDescription.value=e.description||"");["bookTitle","bookAuthor","bookCategory"].forEach(e=>{const t=document.getElementById(e);t&&this.validateField(t)}),this.updateCoverPreview()}handleSubmit(){const e=this.getFormData();this.validateForm(e)&&(this.currentBookId?window.dispatchEvent(new CustomEvent("book:update",{detail:{id:this.currentBookId,data:e}})):window.dispatchEvent(new CustomEvent("book:add",{detail:{data:e}})),this.close())}getFormData(){const e=e=>{const t=document.getElementById(e);return t?t.value.trim():""};return{title:e("bookTitle"),author:e("bookAuthor"),category:e("bookCategory"),cover:e("bookCover"),description:e("bookDescription")}}validateForm(e){const t=[];return e.title||t.push("Tiêu đề sách không được để trống"),e.author||t.push("Tác giả không được để trống"),e.category||t.push("Thể loại không được để trống"),!(t.length>0)||(this.showValidationErrors(t),!1)}updateCoverPreview(){const e=document.getElementById("bookCover");if(!e)return;const t=e.value.trim();let o=document.getElementById("coverPreviewContainer");if(!o){const t=e.closest(".form-group");if(!t)return;o=document.createElement("div"),o.id="coverPreviewContainer",o.style.marginTop="8px",o.style.border="1px dashed rgba(0,0,0,0.15)",o.style.borderRadius="8px",o.style.padding="8px",o.style.background="rgba(255,255,255,0.3)",o.innerHTML='<div id="coverPreview" style="height: 160px; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:6px; background:#f8fafc; color:#64748b; font-size:12px;">Dán URL ảnh để xem trước</div>',t.appendChild(o)}const n=document.getElementById("coverPreview");if(!n)return;if(!t)return n.textContent="Dán URL ảnh để xem trước",void(n.style.backgroundImage="none");if(t.includes("bing.com/images/search")||t.includes("google.com/search")||t.includes("images.google.com"))return void(n.innerHTML='\n                <div style="text-align: center; padding: 20px;">\n                    <div style="font-size: 24px; margin-bottom: 8px;">⚠️</div>\n                    <div style="font-weight: 500; margin-bottom: 4px;">URL không hợp lệ</div>\n                    <div style="font-size: 11px; color: #64748b;">\n                        Đây là link tìm kiếm, không phải link ảnh trực tiếp.<br>\n                        Hãy click chuột phải vào ảnh → "Copy image address"\n                    </div>\n                </div>\n            ');try{new URL(t)}catch{return void(n.innerHTML='\n                <div style="text-align: center; padding: 20px;">\n                    <div style="font-size: 24px; margin-bottom: 8px;">❌</div>\n                    <div style="font-weight: 500; margin-bottom: 4px;">URL không hợp lệ</div>\n                    <div style="font-size: 11px; color: #64748b;">\n                        Vui lòng nhập URL ảnh hợp lệ (bắt đầu bằng http:// hoặc https://)\n                    </div>\n                </div>\n            ')}n.innerHTML='\n            <div style="text-align: center; padding: 20px;">\n                <div style="font-size: 24px; margin-bottom: 8px;">⏳</div>\n                <div style="font-weight: 500;">Đang tải ảnh...</div>\n            </div>\n        ';const i=document.createElement("img");i.src=t,i.alt="Xem trước ảnh bìa",i.loading="eager",i.referrerPolicy="no-referrer",i.crossOrigin="anonymous",i.style.maxWidth="100%",i.style.maxHeight="150px",i.style.objectFit="contain",i.style.borderRadius="6px",i.style.display="none",i.onload=()=>{n.innerHTML="",n.style.background="#f8fafc",n.style.backgroundImage="none",n.appendChild(i),i.style.display="block",i.style.opacity="0",i.style.transition="opacity 0.3s ease",setTimeout(()=>{i.style.opacity="1"},100)},i.onerror=()=>{n.innerHTML='\n                <div style="text-align: center; padding: 20px;">\n                    <div style="font-size: 24px; margin-bottom: 8px;">❌</div>\n                    <div style="font-weight: 500; margin-bottom: 4px;">Không tải được ảnh</div>\n                    <div style="font-size: 11px; color: #64748b;">\n                        URL có thể không tồn tại hoặc không cho phép truy cập từ bên ngoài\n                    </div>\n                </div>\n            '}}showValidationErrors(e){const t=e.join("\n");alert("Vui lòng kiểm tra lại thông tin:\n"+t)}trapFocus(){if(!this.modal)return;const e=this.modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),t=e[0],o=e[e.length-1],n=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===t&&(o.focus(),e.preventDefault()):document.activeElement===o&&(t.focus(),e.preventDefault()))};this.modal.addEventListener("keydown",n),this.cleanupFocusTrap=()=>{this.modal.removeEventListener("keydown",n)}}cleanup(){this.cleanupFocusTrap&&this.cleanupFocusTrap()}announceModalOpen(){const e=document.getElementById("modalTitle");if(e){const t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=`Modal ${e.textContent} đã mở`,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)}}returnFocus(){this.lastFocusedElement&&this.lastFocusedElement.focus()}setTriggerElement(e){this.lastFocusedElement=e}}class w{static loadSampleData(){return[{id:1,title:"JavaScript: The Good Parts",author:"Douglas Crockford",category:"Programming",description:"A comprehensive guide to JavaScript programming",cover:"https://images-na.ssl-images-amazon.com/images/I/81kqrwS1nNL.jpg"},{id:2,title:"Clean Code",author:"Robert C. Martin",category:"Programming",description:"A Handbook of Agile Software Craftsmanship",cover:"https://images-na.ssl-images-amazon.com/images/I/515iEcDr1GL.jpg"},{id:3,title:"Design Patterns",author:"Gang of Four",category:"Programming",description:"Elements of Reusable Object-Oriented Software",cover:"https://images-na.ssl-images-amazon.com/images/I/51szD9HC9pL.jpg"}]}static async loadFromAPI(){try{const e=await fetch("/api/books");return await e.json()}catch(e){return console.error("Failed to load data from API:",e),this.loadSampleData()}}}class C{constructor(){this.view=null,this.modal=null,this.currentBooks=[],this.currentFilter="",this.currentSearch="",this.init()}init(){console.log("Controller: Initializing..."),console.log("Controller: Creating View..."),this.view=new b,console.log("Controller: View created"),console.log("Controller: Creating Modal..."),this.modal=new k,this.modal.init(),console.log("Controller: Modal created and initialized"),console.log("Controller: Setting up event listeners..."),this.setupEventListeners(),console.log("Controller: Event listeners setup complete"),console.log("Controller: Loading initial data..."),this.loadInitialData(),console.log("Controller: Initial data loaded"),console.log("Controller: Initialization complete")}setupEventListeners(){o.on(n,e=>{this.handleBooksChanged(e)}),o.on(i,e=>{this.handleBookAdded(e)}),o.on(s,e=>{this.handleBookUpdated(e)}),o.on(r,e=>{this.handleBookDeleted(e)}),o.on(a,e=>{this.handleBookSelected(e)}),o.on(l,e=>{this.handleModalOpen(e)}),o.on(c,e=>{this.handleSearchChanged(e)}),o.on(h,e=>{this.handleFilterChanged(e)}),o.on(d,e=>{this.handleError(e)}),o.on(m,e=>{this.handleSuccess(e)}),window.addEventListener("book:add",e=>{this.handleAddBook(e.detail.data)}),window.addEventListener("book:update",e=>{this.handleUpdateBook(e.detail.id,e.detail.data)}),o.on("books:export",()=>{const e=this.exportBooks();if(!e)return;const t=new Blob([e],{type:"application/json;charset=utf-8"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=`bookverse-${Date.now()}.json`,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(o),this.view.showSuccess("Đã xuất dữ liệu JSON")}),o.on("books:import",e=>{try{const t=JSON.parse(e);if(!Array.isArray(t))throw new Error("File JSON không đúng cấu trúc");this.importBooks(t)}catch(t){this.view.showError("File JSON không hợp lệ")}})}loadInitialData(){try{console.log("Controller: Loading initial data...");const e=u.getAll();if(console.log("Controller: Books loaded:",e),0===e.length){console.log("Controller: No books found, loading demo data..."),w.loadSampleData();const e=u.getAll();console.log("Controller: Updated books after demo load:",e),this.currentBooks=e}else this.currentBooks=e;console.log("Controller: Updating view..."),setTimeout(()=>{this.updateView()},100),console.log("Controller: View update scheduled")}catch(e){console.error("Controller: Error loading initial data:",e),this.handleError({message:"Không thể tải dữ liệu ban đầu",error:e})}}handleBooksChanged(e){this.currentBooks=e,this.applyFilters()}handleBookAdded(e){this.view.showSuccess(`Đã thêm sách "${e.title}" thành công!`),this.view.clearSearch(),this.view.clearFilter(),this.currentSearch="",this.currentFilter="",this.updateView()}handleBookUpdated(e){this.view.showSuccess(`Đã cập nhật sách "${e.title}" thành công!`),this.updateView()}handleBookDeleted(e){this.view.showSuccess(`Đã xóa sách "${e.title}" thành công!`),this.updateView()}handleBookSelected(e){const t=u.getById(e.id);t?"edit"===e.action?this.modal.openForEdit(t):"delete"===e.action&&this.handleDeleteBook(e.id):this.view.showError("Không tìm thấy sách!")}handleModalOpen(e){"add"===e.mode&&this.modal.openForAdd()}handleSearchChanged(e){this.currentSearch=e,this.applyFilters()}handleFilterChanged(e){this.currentFilter=e,this.applyFilters()}applyFilters(){let e=[...this.currentBooks];this.currentSearch&&(e=u.search(this.currentSearch)),this.currentFilter&&(e=e.filter(e=>e.category===this.currentFilter)),this.view.renderBooks(e)}handleAddBook(e){try{u.add(e)}catch(t){this.view.showError(t.message||"Không thể thêm sách!")}}handleUpdateBook(e,t){try{u.update(e,t)}catch(o){this.view.showError(o.message||"Không thể cập nhật sách!")}}handleDeleteBook(e){try{u.remove(e)||this.view.showError("Không thể xóa sách!")}catch(t){this.view.showError(t.message||"Không thể xóa sách!")}}updateView(){try{console.log("Controller: Updating view..."),this.currentBooks=u.getAll(),console.log("Controller: Current books updated:",this.currentBooks.length),console.log("Controller: Applying filters..."),this.applyFilters(),console.log("Controller: Getting stats...");const e=u.getStats();if(console.log("Controller: Stats:",e),!e.categoryCount||0===Object.keys(e.categoryCount).length){console.log("Controller: No category count data, generating from books...");const t=u.getCategories(),o={};t.forEach(e=>{o[e]=this.currentBooks.filter(t=>t.category===e).length}),e.categoryCount=o,console.log("Controller: Generated category count:",e.categoryCount)}this.view.renderStats(e),console.log("Controller: Getting categories...");const t=u.getCategories();console.log("Controller: Categories:",t),this.view.updateCategoryFilter(t),console.log("Controller: View update complete")}catch(e){console.error("Controller: Error updating view:",e),this.handleError({message:"Không thể cập nhật giao diện",error:e})}}handleError(e){console.error("Controller Error:",e),this.view.showError(e.message||"Đã xảy ra lỗi không xác định!")}handleSuccess(e){this.view.showSuccess(e.message||"Thao tác thành công!")}getState(){return{books:this.currentBooks,search:this.currentSearch,filter:this.currentFilter,stats:u.getStats()}}resetFilters(){this.currentSearch="",this.currentFilter="",this.view.clearSearch(),this.view.clearFilter(),this.applyFilters()}importBooks(e){try{u.importBooks(e)}catch(t){this.view.showError(t.message||"Không thể import sách!")}}exportBooks(){try{const e=u.getAll().map(e=>e.toJSON());return JSON.stringify(e,null,2)}catch(e){return this.view.showError("Không thể xuất dữ liệu sách!"),null}}clearAllBooks(){if(confirm("Bạn có chắc chắn muốn xóa tất cả sách? Hành động này không thể hoàn tác!"))try{u.clear(),this.view.showSuccess("Đã xóa tất cả sách!")}catch(e){this.view.showError("Không thể xóa tất cả sách!")}}}class f{constructor(){this.currentTheme=localStorage.getItem("theme")||"light",this.init()}init(){this.applyTheme(this.currentTheme),this.setupThemeToggle()}applyTheme(e){document.documentElement.setAttribute("data-theme",e),this.currentTheme=e,localStorage.setItem("theme",e),this.updateThemeToggleButton()}toggleTheme(){const e="light"===this.currentTheme?"dark":"light";this.applyTheme(e)}setupThemeToggle(){const e=document.getElementById("themeToggle");e&&e.addEventListener("click",()=>this.toggleTheme())}updateThemeToggleButton(){const e=document.getElementById("themeToggle");if(e){const t=e.querySelector("span");t&&(t.textContent="light"===this.currentTheme?"🌙":"☀️")}}}class E{constructor(){this.themeButton=null,this.currentTheme="light",this.storageKey="theme",this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setupThemeToggle()):this.setupThemeToggle()}setupThemeToggle(){this.createThemeButton(),this.applyInitialTheme(),this.setupEventListeners(),console.log("Theme toggle initialized successfully")}createThemeButton(){const e=document.getElementById("btn-theme-toggle");if(e)return this.themeButton=e,void console.log("Using existing theme toggle button");const t=document.getElementById("addBookBtn");if(!t)return void console.error("Add book button not found");const o=document.createElement("button");o.id="btn-theme-toggle",o.className="btn btn-secondary glass-btn",o.setAttribute("aria-pressed","false"),o.setAttribute("aria-label","Chuyển đổi chế độ sáng/tối"),o.setAttribute("title","Chuyển đổi chế độ sáng/tối (Ctrl+D)");const n=document.createElement("span");n.setAttribute("aria-hidden","true"),n.textContent="🌙",o.appendChild(n),t.parentNode.insertBefore(o,t.nextSibling),this.themeButton=o,console.log("Created new theme toggle button")}applyInitialTheme(){const e=localStorage.getItem(this.storageKey),t=window.matchMedia("(prefers-color-scheme: dark)").matches;this.currentTheme=e||(t?"dark":"light"),this.applyTheme(this.currentTheme)}applyTheme(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem(this.storageKey,e),this.updateButtonState(e),this.currentTheme=e,console.log(`Theme applied: ${e}`)}updateButtonState(e){if(!this.themeButton)return;const t=this.themeButton.querySelector("span"),o="dark"===e;t&&(t.textContent=o?"☀️":"🌙"),this.themeButton.setAttribute("aria-pressed",o.toString()),this.themeButton.setAttribute("aria-label",o?"Chuyển sang chế độ sáng":"Chuyển sang chế độ tối"),this.themeButton.setAttribute("title",o?"Chuyển sang chế độ sáng (Ctrl+D)":"Chuyển sang chế độ tối (Ctrl+D)")}toggleTheme(){const e="light"===this.currentTheme?"dark":"light";this.applyTheme(e),this.addRippleEffect()}addRippleEffect(){if(!this.themeButton)return;const e=document.createElement("div");e.className="ripple-effect",this.themeButton.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},600)}setupEventListeners(){this.themeButton&&(this.themeButton.addEventListener("click",()=>{this.toggleTheme()}),this.themeButton.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.toggleTheme())}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"d"===e.key&&(e.preventDefault(),this.toggleTheme())}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem(this.storageKey)||(this.currentTheme=e.matches?"dark":"light",this.applyTheme(this.currentTheme))}))}getCurrentTheme(){return this.currentTheme}setTheme(e){"light"!==e&&"dark"!==e||this.applyTheme(e)}}function B(){return new E}"undefined"!=typeof window&&setTimeout(()=>{B()},100);const I=new class{constructor(){this.controller=null,this.isInitialized=!1}async init(){try{this.showLoadingState(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initializeApp()):this.initializeApp()}catch(e){console.error("Failed to initialize BookVerse app:",e),this.showErrorState("Không thể khởi tạo ứng dụng. Vui lòng tải lại trang.")}}async initializeApp(){try{await new Promise(e=>setTimeout(e,100)),this.themeManager=new f,this.controller=new C,this.setupGlobalErrorHandling(),this.setupKeyboardShortcuts(),this.setupAccessibility(),B(),this.isInitialized=!0,this.hideLoadingState(),this.showWelcomeMessage()}catch(e){console.error("Error initializing application:",e),this.showErrorState("Lỗi khởi tạo ứng dụng: "+e.message)}}showLoadingState(){const e=document.querySelector(".app-container");e&&(e.style.display="none");const t=document.createElement("div");t.className="app-loading",t.innerHTML='\n            <div class="loading-container glass">\n                <div class="loading-spinner"></div>\n                <h2>📚 BookVerse</h2>\n                <p>Đang khởi tạo ứng dụng...</p>\n            </div>\n        ',document.body.appendChild(t)}hideLoadingState(){const e=document.querySelector(".app-loading");e&&e.remove();const t=document.querySelector(".app-container");t&&(t.style.display="block")}showErrorState(e){document.body.innerHTML=`\n            <div class="app-error">\n                <div class="error-container glass">\n                    <div class="error-icon">⚠️</div>\n                    <h2>Lỗi Khởi Tạo</h2>\n                    <p>${e}</p>\n                    <button class="btn btn-primary" onclick="location.reload()">\n                        Tải Lại Trang\n                    </button>\n                </div>\n            </div>\n        `}showWelcomeMessage(){if(this.controller&&this.controller.getState()){const e=this.controller.getState().books;e&&0===e.length&&setTimeout(()=>{o.emit(m,{message:"Chào mừng đến với BookVerse! Hãy thêm sách đầu tiên của bạn."})},1e3)}}setupGlobalErrorHandling(){window.addEventListener("error",e=>{console.error("Global error:",e.error),o.emit(d,{message:"Đã xảy ra lỗi không xác định",error:e.error})}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason),o.emit(d,{message:"Lỗi xử lý bất đồng bộ",error:e.reason})})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"n"===e.key&&(e.preventDefault(),o.emit(l,{mode:"add"})),(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),this.controller&&this.controller.view&&this.controller.view.focusSearch()),"Escape"===e.key&&this.controller&&this.controller.view&&this.controller.view.getSearchQuery()&&this.controller.resetFilters(),(e.ctrlKey||e.metaKey)&&"/"===e.key&&(e.preventDefault(),this.showKeyboardShortcuts()),(e.ctrlKey||e.metaKey)&&"d"===e.key&&(e.preventDefault(),this.toggleTheme())})}showKeyboardShortcuts(){const e=[{key:"Ctrl/Cmd + N",action:"Thêm sách mới"},{key:"Ctrl/Cmd + F",action:"Tìm kiếm"},{key:"Escape",action:"Đóng modal / Xóa tìm kiếm"},{key:"Ctrl/Cmd + /",action:"Hiện phím tắt"},{key:"Ctrl/Cmd + D",action:"Chuyển đổi chế độ sáng/tối"}].map(e=>`${e.key}: ${e.action}`).join("\n");alert("Phím tắt:\n\n"+e)}initThemeManager(){const e=document.getElementById("themeToggle");e&&e.addEventListener("click",()=>{this.toggleTheme()});const t=localStorage.getItem("bookverse-theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n=t||o;document.documentElement.setAttribute("data-theme",n),this.updateThemeToggleButton(n)}toggleTheme(){const e="light"===document.documentElement.getAttribute("data-theme")?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("bookverse-theme",e),this.updateThemeToggleButton(e)}updateThemeToggleButton(e){const t=document.getElementById("themeToggle");if(t){const o=t.querySelector("span");o&&(o.textContent="light"===e?"🌙":"☀️"),t.setAttribute("aria-label","light"===e?"Chuyển sang chế độ tối":"Chuyển sang chế độ sáng")}}setupAccessibility(){const e=document.createElement("div");e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",e.textContent="Trang BookVerse đã tải xong. Sử dụng Tab để điều hướng.",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},3e3),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(document.documentElement.style.setProperty("--animation-duration","0.01ms"),document.documentElement.style.setProperty("--animation-iteration-count","1")),window.matchMedia("(prefers-contrast: high)").matches&&document.documentElement.classList.add("high-contrast")}getState(){return this.controller?this.controller.getState():null}isReady(){return this.isInitialized}initThemeManager(){this.themeManager=new f}toggleTheme(){this.themeManager&&this.themeManager.toggleTheme()}updateThemeToggleButton(){this.themeManager&&this.themeManager.updateThemeToggleButton()}};I.init(),window.BookVerseApp=I;
